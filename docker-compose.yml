---
version: '3.5'

services:
  shared-database:
    image: postgres
    volumes:
      - ./database:/docker-entrypoint-initdb.d
    environment:
      POSTGRES_MULTIPLE_DATABASES: ccd,ccd_user_profile,ccd_definition,ccd_data,ccd_definition_designer,div_scheduler,fees_register,payment
      DB_USERNAME:
      DB_PASSWORD:
      POSTGRES_HOST_AUTH_METHOD: trust
    ports:
      - 5050:5432

  ccd-user-profile-api:
    image: "${CCD_USER_PROFILE_API_USE_LOCAL-hmctspublic.azurecr.io/}ccd/user-profile-api:${CCD_USER_PROFILE_API_TAG:-latest}"
    environment:
      JAVA_TOOL_OPTIONS: -Xms128m -Xmx400m
      USER_PROFILE_DB_HOST: shared-database
      USER_PROFILE_DB_PORT: 5432
      USER_PROFILE_DB_USERNAME: "${DB_USERNAME}"
      USER_PROFILE_DB_PASSWORD: "${DB_PASSWORD}"
      USER_PROFILE_DB_USE_SSL: "false"
      USER_PROFILE_S2S_AUTHORISED_SERVICES: ccd_data,ccd_definition,ccd_admin
      IDAM_S2S_URL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
      APPINSIGHTS_INSTRUMENTATIONKEY: key
    ports:
      - 4453:4453
    depends_on:
      - shared-database

  ccd-definition-store-api:
    image: "${CCD_DEFINITION_STORE_API_USE_LOCAL-hmctspublic.azurecr.io/}ccd/definition-store-api:${CCD_DEFINITION_STORE_API_TAG:-latest}"
    environment:
      JAVA_TOOL_OPTIONS: -Xms128m -Xmx400m
      DEFINITION_STORE_DB_HOST: shared-database
      DEFINITION_STORE_DB_PORT: 5432
      DEFINITION_STORE_DB_USERNAME: "${DB_USERNAME}"
      DEFINITION_STORE_DB_PASSWORD: "${DB_PASSWORD}"
      DEFINITION_STORE_DB_USE_SSL: "false"
      DEFINITION_STORE_IDAM_KEY:
      DEFINITION_STORE_S2S_AUTHORISED_SERVICES: ccd_data,ccd_gw,ccd_admin,nfdiv_cms,nfdiv_cos
      USER_PROFILE_HOST: http://ccd-user-profile-api:4453
      IDAM_USER_URL: http://idam-api:5000
      IDAM_S2S_URL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
      REFORM_SERVICE_NAME: ccd-definition-store-api
      ELASTIC_SEARCH_ENABLED: "true"
      ELASTIC_SEARCH_HOST: "ccd-elasticsearch"
      ELASTIC_SEARCH_FAIL_ON_IMPORT: "true"
      APPINSIGHTS_INSTRUMENTATIONKEY: key
    ports:
      - 4451:4451
    depends_on:
      - shared-database
      - ccd-user-profile-api

  ccd-data-store-api:
    image: "${CCD_DATA_STORE_API_USE_LOCAL-hmctspublic.azurecr.io/}ccd/data-store-api:${CCD_DATA_STORE_API_TAG:-latest}"
    environment:
      JAVA_TOOL_OPTIONS: -Xms128m -Xmx600m
      DATA_STORE_DB_HOST: shared-database
      DATA_STORE_DB_PORT: 5432
      DATA_STORE_DB_USERNAME: "${DB_USERNAME}"
      DATA_STORE_DB_PASSWORD: "${DB_PASSWORD}"
      DATA_STORE_DB_USE_SSL: "false"
      DATA_STORE_IDAM_KEY:
      DATA_STORE_S2S_AUTHORISED_SERVICES: ccd_gw,fpl_case_service,ccd_data,ccd_ps,nfdiv_cos,nfdiv_cms,payment-api,xui_webapp
      CCD_DM_DOMAIN: http://dm-store-aat.service.core-compute-aat.internal
      DEFINITION_STORE_HOST: http://ccd-definition-store-api:4451
      USER_PROFILE_HOST: http://ccd-user-profile-api:4453
      IDAM_USER_URL: http://idam-api:5000
      IDAM_S2S_URL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
      ELASTIC_SEARCH_ENABLED: "true"
      ELASTIC_SEARCH_HOSTS: ccd-elasticsearch:9200
      ELASTIC_SEARCH_DATA_NODES_HOSTS: "http://ccd-elasticsearch:9200"
      DATA_STORE_DEFAULT_LOG_LEVEL: INFO
      APPINSIGHTS_INSTRUMENTATIONKEY: key
    ports:
      - 4452:4452
      - 5005:5005
    depends_on:
      - shared-database
      - ccd-user-profile-api
      - ccd-definition-store-api
      - idam-api

  ccd-api-gateway:
    image: hmctspublic.azurecr.io/ccd/api-gateway-web:latest
    environment:
      IDAM_BASE_URL: http://idam-api:5000
      IDAM_USER_URL: http://idam-api:5000
      IDAM_S2S_URL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
      IDAM_SERVICE_KEY:
      IDAM_OAUTH2_LOGOUT_ENDPOINT: http://idam-api:5000/session/:token
      IDAM_OAUTH2_CLIENT_ID: ccd_gateway
      IDAM_OAUTH2_CLIENT_SECRET: "${CCD_OAUTH_SECRET}"
      IDAM_OAUTH2_TOKEN_ENDPOINT: http://idam-api:5000/oauth2/token
      PROXY_DOCUMENT_MANAGEMENT: http://dm-store-aat.service.core-compute-aat.internal
      ADDRESS_LOOKUP_TOKEN:
      PROXY_AGGREGATED: http://ccd-data-store-api:4452
      PROXY_DATA: http://ccd-data-store-api:4452
      PROXY_DEFINITION_IMPORT: http://ccd-definition-store-api:4451
      PROXY_DEFINITION_DATA: http://ccd-definition-store-api:4451/api/data
      PROXY_DEFINITION_DISPLAY: http://ccd-definition-store-api:4451/api/display
      PROXY_PAYMENTS: http://payments-api:8080
      APPINSIGHTS_INSTRUMENTATIONKEY: key
    ports:
      - 3453:3453
    depends_on:
      - ccd-user-profile-api
      - ccd-definition-store-api
      - ccd-data-store-api
      - idam-api

  ccd-elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:6.4.2
    environment:
      - JAVA_TOOL_OPTIONS=-Xms128m -Xmx400m
      - ES_JAVA_OPTS= -Xms128m -Xmx400m
      - cluster.name=ccd-docker-es-cluster
      - discovery.type=single-node
      - bootstrap.memory_lock=true
      - action.auto_create_index=.security*,.watches,.triggered_watches,.watcher-history-*,.logstash_dead_letter,.ml*,grantofrepresentation_cases,caveat_cases,legacy_cases,standingsearch_cases,willlodgement_cases
    ulimits:
      memlock:
        soft: -1
        hard: -1
    volumes:
      - esdata1:/usr/share/elasticsearch/data
    ports:
      - 9200:9200

  ccd-logstash:
    image: hmctspublic.azurecr.io/ccd/logstash:ccd-divorce-logstash-latest
    environment:
      - JAVA_TOOL_OPTIONS=-Xms128m -Xmx400m
      - XPACK_MONITORING_ENABLED=false
      - DB_URL=jdbc:postgresql://shared-database:5432/ccd_data?stringtype=unspecified&ssl=false
      - DB_USER=${DB_USERNAME}
      - DB_PWD=${DB_PASSWORD}
      - ES_DATA_NODES_URL=http://ccd-elasticsearch:9200
      - LOG_LEVEL=warn
    depends_on:
      - ccd-elasticsearch
      - shared-database

  nfdiv-cos:
    build:
      context: ./nfdiv-case-orchestration-service/
    environment:
      UK_GOV_NOTIFY_API_KEY:
      IDAM_CITIZEN_USERNAME: "${IDAM_CITIZEN_USERNAME}"
      IDAM_CITIZEN_PASSWORD: "${IDAM_CITIZEN_PASSWORD}"
      IDAM_CASEWORKER_USERNAME: "${IDAM_TEST_CASEWORKER_USERNAME}"
      IDAM_CASEWORKER_PASSWORD: "${IDAM_TEST_CASEWORKER_PASSWORD}"
      IDAM_CLIENT_SECRET: "${OAUTH2_CLIENT_SECRET}"
      CASE_MAINTENANCE_SERVICE_API_BASEURL: http://nfdiv-cms:4010
      IDAM_API_URL: http://idam-api:5000
      IDAM_API_REDIRECT_URL: https://div-pfe-aat.service.core-compute-aat.internal/authenticated
      PAYMENT_API_BASEURL: http://payments-api:8080
      PRD_API_BASEURL: http://rd-professional-api-aat.service.core-compute-aat.internal
      SEND_LETTER_SERVICE_BASEURL: http://rpe-send-letter-service-aat.service.core-compute-aat.internal
      CASE_FORMATTER_SERVICE_API_BASEURL: http://div-cfs-aat.service.core-compute-aat.internal
      SERVICE_AUTH_PROVIDER_URL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
      DOCUMENT_GENERATOR_SERVICE_API_BASEURL: http://div-dgs:4007
      FEES_AND_PAYMENTS_SERVICE_API_BASEURL: http://div-fps-aat.service.core-compute-aat.internal
      DOCUMENT_MANAGEMENT_STORE_URL: http://dm-store-aat.service.core-compute-aat.internal
      SERVICE_AUTH_SECRET: "${COS_S2S_SECRET}"
      SCHEDULER_RE_CREATE: "true"
      SOLICITOR_DN_REJECT_AND_AMEND: "true"
      FEATURE_SHARE_A_CASE: "true"
      PAY_BY_ACCOUNT: "true"
      FEATURE_DN_REFUSAL: "true"
      FEATURE_RESP_SOLICITOR_DETAILS: "true"
      DIV_SCHEDULER_DB_HOST: "shared-database"
      DIV_SCHEDULER_DB_PORT: "5432"
      DIV_SCHEDULER_DB_NAME: "div_scheduler"
      DIV_SCHEDULER_DB_USER_NAME: "${DB_USERNAME}"
      DIV_SCHEDULER_DB_PASSWORD: "${DB_PASSWORD}"
      FLYWAY_URL: "jdbc:postgresql://shared-database:5432/div_scheduler"
      DATAEXTRACTION_STATUS_DA_EMAILTO: da_data_extraction@sharklasers.com
      DATAEXTRACTION_STATUS_AOS_EMAILTO: aos_data_extraction@sharklasers.com
      DATAEXTRACTION_STATUS_DN_EMAILTO: dn_data_extraction@sharklasers.com
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "true"
      SPRING_MAIL_HOST: smtp-server
      SPRING_MAIL_PORT: 1025
      SPRING_MAIL_TEST_CONNECTION: "false"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_SSL_TRUST: "*"
      #Scheduler parameters
      SCHEDULER_ENABLED: "false"
      SCHEDULER_MAKE_ELIGIBLE_CASES_AOS_OVERDUE_ENABLED: "false"
      SCHEDULER_MAKE_ELIGIBLE_CASES_AOS_OVERDUE_CRON: "0 0/10 * ? * * *"#Runs every 10 minutes (if enabled)
    ports:
      - 4012:4012
    depends_on:
      - shared-database
      - idam-api
      - div-dgs
      - nfdiv-cms
      - payments-api
      - smtp-server

  nfdiv-cms:
    build:
      context: ./nfdiv-case-maintenance-service/
    environment:
      IDAM_API_BASEURL: http://idam-api:5000
      IDAM_API_REDIRECT_URL: https://div-pfe-aat.service.core-compute-aat.internal/authenticated
      IDAM_CASEWORKER_USERNAME:
      IDAM_CASEWORKER_PASSWORD:
      AUTH2_CLIENT_SECRET: "${OAUTH2_CLIENT_SECRET}"
      AUTH_PROVIDER_SERVICE_CLIENT_BASEURL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
      CASE_FORMATTER_SERVICE_API_BASEURL: http://div-cfs-aat.service.core-compute-aat.internal
      CASE_DATA_STORE_BASEURL: http://ccd-data-store-api:4452
      AUTH_PROVIDER_SERVICE_CLIENT_KEY: "${CMS_S2S_SECRET}"
      LOG_LEVEL: DEBUG
    ports:
      - 4010:4010
    depends_on:
      - ccd-data-store-api
      - idam-api

  xui-manage-cases:
    image: "${XUI_MANAGE_CASES_USE_LOCAL-hmctspublic.azurecr.io/}xui/webapp:${XUI_MANAGE_CASES_TAG:-latest}"
    environment:
      FEATURE_APP_INSIGHTS_ENABLED: "true"
      FEATURE_SECURE_COOKIE_ENABLED: "false"
      FEATURE_REDIS_ENABLED: "false"
      JURISDICTIONS: AUTOTEST1,DIVORCE,PROBATE,BEFTA_JURISDICTION_3,BEFTA_JURISDICTION_2,BEFTA_JURISDICTION_1,IA,SSCS,BEFTA_MASTER
      MICROSERVICE: xui_webapp
      PROTOCOL: http
      XUI_ENV: local
      SERVICES_DOCUMENTS_API: http://dm-store-aat.service.core-compute-aat.internal
      SERVICES_PAYMENTS_URL: http://payments-api:8080
      SERVICES_EM_ANNO_API: http://ccd-api-gateway:3453
      SERVICES_CCD_COMPONENT_API: http://ccd-api-gateway:3453
      SERVICES_CCD_DATA_STORE_API: http://ccd-data-store-api:4452
      SERVICES_IDAM_API_URL: http://idam-api:5000
      SERVICES_IDAM_CLIENT_ID: xuiwebapp
      SERVICES_IDAM_LOGIN_URL: http://localhost:3501
      SERVICES_IDAM_INDEX_URL: /
      SERVICES_IDAM_OAUTH_CALLBACK_URL: /oauth2/callback
      SERVICES_S2S: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
      REDISCLOUD_URL: http://localhost:6780
      HEALTH_CCD_COMPONENT_API: http://ccd-api-gateway:3453/health
      HEALTH_CCD_DATA_API: http://ccd-data-store-api:4452/health
      APPINSIGHTS_INSTRUMENTATIONKEY: TESTVAR
      IDAM_SECRET: "${XUI_OAUTH_SECRET}"
      S2S_SECRET: "${XUI_SERVICE_KEY}"
      LAUNCH_DARKLY_CLIENT_ID: 1
    ports:
      - 3000:3000
    depends_on:
      - ccd-api-gateway
      - ccd-data-store-api
      - idam-api

  div-dgs:
    image: hmctspublic.azurecr.io/div/dgs:latest
    healthcheck:
      retries: 10
    environment:
      AUTH_PROVIDER_SERVICE_CLIENT_BASEURL: "http://rpe-service-auth-provider-aat.service.core-compute-aat.internal"
      EVIDENCE_MANAGEMENT_CLIENT_API_BASEURL: "http://div-emca:4006"
      IDAM_S2S_URL: "http://rpe-service-auth-provider-aat.service.core-compute-aat.internal"
      PDF_SERVICE_BASEURL: "http://cmc-pdf-service-aat.service.core-compute-aat.internal"
      DOCMOSIS_SERVICE_BASE_URL: "https://docmosis-development.platform.hmcts.net"
      REFORM_SERVICE_NAME: "dgs"
      REFORM_TEAM: "div"
      AUTH_PROVIDER_SERVICE_CLIENT_MICROSERVICE: "divorce_document_generator"
      AUTH_PROVIDER_SERVICE_CLIENT_TOKENTIMETOLIVEINSECONDS: "900"
      EVIDENCE_MANAGEMENT_CLIENT_API_HEALTH_ENDPOINT: "/health"
      AUTH_PROVIDER_SERVICE_CLIENT_KEY: "${AUTH_PROVIDER_SERVICE_CLIENT_KEY}"
      DOCMOSIS_SERVICE_ACCESS_KEY: "${DOCMOSIS_SERVICE_ACCESS_KEY}"
    depends_on:
      - div-emca
    ports:
    - 4007:4007

  div-emca:
    image: hmctspublic.azurecr.io/div/emca:latest
    healthcheck:
      retries: 10
    environment:
      AUTH_PROVIDER_SERVICE_CLIENT_BASEURL: "http://rpe-service-auth-provider-aat.service.core-compute-aat.internal"
      DOCUMENT_MANAGEMENT_STORE_URL: "http://dm-store-aat.service.core-compute-aat.internal"
      EVIDENCE_MANAGEMENT_HEALTH_URL: "http://dm-store-aat.service.core-compute-aat.internal/health"
      EVIDENCE_MANAGEMENT_UPLOAD_FILE_URL: "http://dm-store-aat.service.core-compute-aat.internal/documents"
      AUTH_PROVIDER_SERVICE_CLIENT_MICROSERVICE: "divorce_document_generator"
      IDAM_API_URL: "http://idam-api:5000"
      AUTH_PROVIDER_SERVICE_CLIENT_TOKENTIMETOLIVEINSECONDS: "900"
      HTTP_CONNECT_REQUEST_TIMEOUT: "60000"
      HTTP_CONNECT_SOCKET_TIMEOUT: "5000"
      HTTP_CONNECT_TIMEOUT: "60000"
      AUTH_PROVIDER_SERVICE_CLIENT_KEY: "${AUTH_PROVIDER_SERVICE_CLIENT_KEY}"
    depends_on:
      - idam-api
    ports:
    - 4006:4006

  idam-api:
    image: "hmctspublic.azurecr.io/idam/api:stable"
    environment:
      JAVA_TOOL_OPTIONS: -Xms128m -Xmx400m
      TESTING_SUPPORT_ENABLED: "true"
      IDAMHEALTHCHECK_AM_ENABLED: "false"
      IDAMHEALTHCHECK_IDM_ENABLED: "false"
      STRATEGIC_ADMIN_URL: http://localhost:8082
      STRATEGIC_WEBPUBLIC_URL: http://localhost:3501
      SPRING_PROFILES_ACTIVE: local
      SPRING_DATASOURCE_URL: jdbc:postgresql://shared-db:5432/openidm?currentSchema=fridam
      SPRING_DATASOURCE_USERNAME: openidm
      SPRING_DATASOURCE_PASSWORD: openidm
      SPRING_DATA_ELASTICSEARCH_PROPERTIES_PATH_HOME: /tmp/es
      SECURITY_OAUTH2_CLIENT_CLIENTSECRET: password
      SECURITY_OAUTH2_CLIENT_PRE_ESTABLISHED_REDIRECT_URI: http://localhost:3501/login
      SECURITY_OAUTH2_CLIENT_REGISTERED_REDIRECT_URI: http://localhost:3501/login
      IDAM_SPI_FORGEROCK_AM_ROOT: http://fr-am:8080/openam
      IDAM_SPI_FORGEROCK_AM_TOPLEVELHOST: fr-am
      IDAM_SPI_FORGEROCK_AM_USERNAME: amadmin
      IDAM_SPI_FORGEROCK_AM_PASSWORD: Pa55word11
      IDAM_SPI_FORGEROCK_AM_JWKSURIFOROAUTH2CLIENTS: http://fr-am:8080/openam/oauth2/hmcts/connect/jwk_uri
      IDAM_SPI_FORGEROCK_IDM_ROOT: http://fr-idm:18080/openidm
      IDAM_SPI_FORGEROCK_IDM_USERNAME: openidm-admin
      IDAM_SPI_FORGEROCK_IDM_PASSWORD: openidm-admin
      IDAM_SPI_FORGEROCK_IDM_PIN_DEFAULTPASSWORD: BlaBlaBlackSh33p
      APPSETTING_NODE_PATH: es/
    ports:
      - 5000:5000
    depends_on:
      - fr-am
      - fr-idm
      - shared-db

  fr-am:
    image: "hmctsprivate.azurecr.io/idam/idam-fr-am:latest"
    environment:
      JAVA_TOOL_OPTIONS: -Xms128m -Xmx400m
    ports:
      - 2889:8080
      - 1389:1389
    depends_on:
      - shared-db

  fr-idm:
    image: "hmctsprivate.azurecr.io/idam/idam-fr-idm:latest"
    environment:
      JAVA_TOOL_OPTIONS: -Xms128m -Xmx400m
    ports:
      - 18080:18080
      - 9010:9010
    depends_on:
      - fr-am
      - shared-db

  idam-web-public:
    image: "hmctspublic.azurecr.io/idam/web-public:stable"
    environment:
      JAVA_TOOL_OPTIONS: -Xms128m -Xmx256m
      STRATEGIC_SERVICE_URL: http://idam-api:5000
      IDAM_CONTINUE_URL_VALIDATOR_ENFORCE_TLS: "false"
      REFORM_SERVICE_NAME: idam-api
      REFORM_TEAM: idam
      REFORM_ENVIRONMENT: local
    ports:
      - 3501:8080
    links:
      - idam-api
    depends_on:
      - idam-api

  fees-api:
    image: hmctspublic.azurecr.io/fees-register/api
    environment:
      JAVA_TOOL_OPTIONS: -Xms128m -Xmx256m
      SPRING_DATASOURCE_URL: "jdbc:postgresql://shared-database:5432/fees_register"
      SPRING_DATASOURCE_USERNAME: "${DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${DB_PASSWORD}"
      AUTH_IDAM_CLIENT_BASEURL: "http://idam-api:5000"
      APPINSIGHTS_INSTRUMENTATIONKEY: "key"
      SPRING_LIQUIBASE_ENABLED: "true"
      ENABLE_FEE_LOADER: "true"
    ports:
      - 4411:8080
    depends_on:
      - idam-api
      - shared-database

  payments-api:
    container_name: payments-api
    image: hmctspublic.azurecr.io/payment/api:latest
    environment:
      - JAVA_TOOL_OPTIONS=-Xms128m -Xmx400m
      - AUTH_PROVIDER_SERVICE_CLIENT_BASEURL=http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
      - IDAM_S2S-AUTH_URL=http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
      - AUTH_IDAM_CLIENT_BASEURL=http://idam-api:5000
      - CARD_PAYMENTS_REPORT_SCHEDULER_ENABLED=true
      - CARD_PAYMENTS_EMAIL_FROM=no-reply@reform.hmcts.net
      - CARD_PAYMENTS_EMAIL_TO=pepito@grillo.com
      - CARD_PAYMENTS_EMAIL_MESSAGE=hi
      - CARD_PAYMENTS_EMAIL_SUBJECT=Docker Env Card Payments Reconciliation Report
      - BAR_PAYMENTS_REPORT_SCHEDULER_ENABLED=true
      - BAR_PAYMENTS_EMAIL_FROM=no-reply@reform.hmcts.net
      - BAR_PAYMENTS_EMAIL_TO=pepito@grillo.com
      - BAR_PAYMENTS_EMAIL_MESSAGE=hi
      - BAR_PAYMENTS_EMAIL_SUBJECT=Docker Env Bar Payments Reconciliation Report
      - FEATURE_PAYMENTS_SEARCH=true
      - FEES_REGISTER_URL=https://fees-api:8080
      - GOV_PAY_AUTH_KEY_CMC=la0ohpqa9er1bub2hddieeesc6sabbbqn4smkkve7s9ailn3n9d3hbnhc3
      - GOV_PAY_AUTH_KEY_DIVORCE_FRONTEND=la0ohpqa9er1bub2hddieeesc6sabbbqn4smkkve7s9ailn3n9d3hbnhc3
      - GOV_PAY_AUTH_KEY_PROBATE_FRONTEND=la0ohpqa9er1bub2hddieeesc6sabbbqn4smkkve7s9ailn3n9d3hbnhc3
      - GOV_PAY_OPERATIONAL_SERVICES=ccd_gw
      - GOV_PAY_URL=https://publicapi.payments.service.gov.uk/v1/payments
      - payments.report.file.location=.
      - PBA_CMC_PAYMENTS_REPORT_SCHEDULER_ENABLED=true
      - PBA_CMC_PAYMENTS_EMAIL_FROM=no-reply@reform.hmcts.net
      - PBA_CMC_PAYMENTS_EMAIL_TO=pepito@grillo.com
      - PBA_CMC_PAYMENTS_EMAIL_MESSAGE=hi
      - PBA_CMC_PAYMENTS_EMAIL_SUBJECT=Docker Env Card Payments Reconciliation Report
      - PBA_PROBATE_PAYMENTS_REPORT_SCHEDULER_ENABLED=true
      - PBA_PROBATE_PAYMENTS_EMAIL_FROM=no-reply@reform.hmcts.net
      - PBA_PROBATE_PAYMENTS_EMAIL_TO=pepito@grillo.com
      - PBA_PROBATE_PAYMENTS_EMAIL_MESSAGE=hi
      - PBA_PROBATE_PAYMENTS_EMAIL_SUBJECT=Docker Env Card Payments Reconciliation Report
      - PBA_FINREM_PAYMENTS_REPORT_SCHEDULER_ENABLED=true
      - PBA_FINREM_PAYMENTS_EMAIL_FROM=no-reply@reform.hmcts.net
      - PBA_FINREM_PAYMENTS_EMAIL_TO=pepito@grillo.com
      - PBA_FINREM_PAYMENTS_EMAIL_MESSAGE=hi
      - PBA_FINREM_PAYMENTS_EMAIL_SUBJECT=Docker Env Card Payments Reconciliation Report
      - PBA_DIVORCE_PAYMENTS_REPORT_SCHEDULER_ENABLED=true
      - PBA_DIVORCE_PAYMENTS_EMAIL_FROM=no-reply@reform.hmcts.net
      - PBA_DIVORCE_PAYMENTS_EMAIL_TO=pepito@grillo.com
      - PBA_DIVORCE_PAYMENTS_EMAIL_MESSAGE=hi
      - PBA_DIVORCE_PAYMENTS_EMAIL_SUBJECT=Docker Env Card Payments Reconciliation Report
      - PBA_FPL_PAYMENTS_REPORT_SCHEDULER_ENABLED=true
      - PBA_FPL_PAYMENTS_EMAIL_FROM=no-reply@reform.hmcts.net
      - PBA_FPL_PAYMENTS_EMAIL_TO=pepito@grillo.com
      - PBA_FPL_PAYMENTS_EMAIL_MESSAGE=hi
      - PBA_FPL_PAYMENTS_EMAIL_SUBJECT=Docker Env Card Payments Reconciliation Report
      - REFORM_ENVIRONMENT=aat
      - REFORM_SERVICE_NAME=payment-api
      - REFORM_TEAM=cc
      - SPRING_DATASOURCE_URL=jdbc:postgresql://shared-database:5432/payment
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
      - SPRING_LIQUIBASE_ENABLED=true
      - SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE=true
      - SPRING_MAIL_PROPERTIES_MAIL_SMTP_SSL_TRUST=*
      - SPRING_MAIL_PORT=25
      - SPRING_MAIL_HOST=smtp-server
      - TRUSTED_S2S_SERVICE_NAMES=cmc,probate_frontend,divorce_frontend,ccd_gw,bar_api,api_gw,finrem_payment_service,ccpay_bubble,jui_webapp,xui_webapp,fpl_case_service,iac,nfdiv_cos,nfdiv_cms
      - PAYBUBBLE_HOME_URL=https://ccpay-bubble-frontend-aat.service.core-compute-aat.internal
      - PCI_PAL_CALLBACK_URL=https://core-api-mgmt-aat.azure-api.net/telephony-api/telephony/callback
      - ASB_CONNECTION_STRING=some-azure-service-bus-connection-string
      - APPINSIGHTS_INSTRUMENTATIONKEY=DUMMY
      - CORE_CASE_DATA_API_URL=http://ccd-data-store-api:4452
      - PAYMENT_S2S_SECRET=${PAYMENT_S2S_SECRET}
      - http_proxy
      - https_proxy
      - no_proxy
    ports:
      - 4401:8080
    depends_on:
      - shared-database
      - idam-api
      - ccd-data-store-api

  smtp-server:
    image: mailhog/mailhog
    restart: always
    ports:
      - 1025:1025
      - 8025:8025

  shared-db:
    image: hmctsprivate.azurecr.io/idam/shared-db:latest
    ports:
      - 5051:5432

volumes:
  ccd-docker-azure-blob-data:
  esdata1:
    driver: local

